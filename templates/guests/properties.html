{% extends "base.html" %}
{% load static %}

{% block title %}Aurban Rentals | Listings{% endblock %}

{% block content_header %}Aurban Listings{% endblock %}

{% block content %}
<style>
    /* Import the Inter font from Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

    /* Apply the Inter font and a professional color scheme */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f8fafc; /* A very light gray-50 */
    }

    /* Custom scrollbar for a cleaner look */
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: #e5e7eb; /* Light gray */
    }
    ::-webkit-scrollbar-thumb {
        background: #d1d5db; /* Medium gray */
        border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #9ca3af; /* Darker gray */
    }

    /* Simple fade-out animation for the notification */
    .fade-out {
        animation: fadeOut 0.5s ease-out 4.5s forwards;
    }
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; display: none; }
    }

    /* Animation for property cards */
    .property-card {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }
    .property-card:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Fade-in animation for cards on load */
    .card-fade-in {
        opacity: 0;
        animation: fadeIn 0.5s ease-in-out forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Animation for heading text */
    .heading-animate {
        opacity: 0;
        animation: slideInUp 0.8s ease-in-out forwards;
    }
    @keyframes slideInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .subheading-animate {
        opacity: 0;
        animation: slideInUp 0.8s ease-in-out 0.2s forwards;
    }

    /* Custom classes for the new color palette */
    .btn-primary {
        background-color: #0d9488; /* Teal-600 */
        color: #ffffff;
        font-weight: 600;
        transition: background-color 0.3s;
    }
    .btn-primary:hover {
        background-color: #0f766e; /* Teal-700 */
    }

    .text-primary {
        color: #0d9488; /* Teal-600 */
    }

    .input-focus-ring:focus {
        border-color: #0d9488; /* Teal-600 */
        outline: none;
        box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.3);
    }
</style>

<!-- Properties Page Content Start -->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Notification Message Area -->
    <div id="notification-message" class="hidden fixed top-20 left-1/2 -translate-x-1/2 z-50 p-4 rounded-lg shadow-lg bg-teal-600 text-white font-semibold text-center transition-all duration-300">
        <!-- Message content will be added by JavaScript -->
    </div>

    <!-- Page Header -->
    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 heading-animate flex items-center justify-center space-x-3">
            <i class="fas fa-search-location text-teal-600"></i>
            <span>Find Your <span class="text-teal-600">Perfect</span> Stay</span>
        </h1>
        <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto subheading-animate">Explore our curated collection of urban rentals. Your next adventure is just a search away.</p>
    </div>

    <!-- Filter and Search Bar -->
    <form method="GET" action="{% url 'guests:guest_properties' %}" id="search-form">
        <div class="bg-white p-6 rounded-xl shadow-lg mb-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-6 items-end">
                <!-- Location -->
                <div class="col-span-full md:col-span-2">
                    <label for="location" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        <span>Where to?</span>
                    </label>
                    <div class="relative">
                        <input type="text" id="location" name="location" placeholder="e.g., Nairobi, Kenya" class="w-full pl-4 pr-4 py-2 border border-gray-300 rounded-lg input-focus-ring" value="{{ location|default:'' }}">
                    </div>
                </div>
                <!-- Check-in Date -->
                <div>
                    <label for="check-in" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        <span>Check-in</span>
                    </label>
                    <input type="date" id="check-in" name="check-in" class="w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm input-focus-ring" value="{{ check_in|default:'' }}">
                </div>
                <!-- Check-out Date -->
                <div>
                    <label for="check-out" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        <span>Check-out</span>
                    </label>
                    <input type="date" id="check-out" name="check-out" class="w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm input-focus-ring" value="{{ check_out|default:'' }}">
                </div>
                <!-- Guests -->
                <div>
                    <label for="guests" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i class="fas fa-users mr-2"></i>
                        <span>Guests</span>
                    </label>
                    <select id="guests" name="guests" class="w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm input-focus-ring">
                        <option {% if guests == 'All Guests' %}selected{% endif %}>All Guests</option>
                        <option {% if guests == '1 Guest' %}selected{% endif %}>1 Guest</option>
                        <option {% if guests == '2 Guests' %}selected{% endif %}>2 Guests</option>
                        <option {% if guests == '3 Guests' %}selected{% endif %}>3 Guests</option>
                        <option {% if guests == '4+ Guests' %}selected{% endif %}>4+ Guests</option>
                    </select>
                </div>
                <!-- Property Type -->
                <div>
                    <label for="property-type" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i class="fas fa-house-user mr-2"></i>
                        <span>Property Type</span>
                    </label>
                    <select id="property-type" name="property-type" class="w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm input-focus-ring">
                        <option {% if property_type == 'All Types' %}selected{% endif %}>All Types</option>
                        <option {% if property_type == 'Apartment' %}selected{% endif %}>Apartment</option>
                        <option {% if property_type == 'Villa' %}selected{% endif %}>Villa</option>
                        <option {% if property_type == 'Loft' %}selected{% endif %}>Loft</option>
                        <option {% if property_type == 'Studio' %}selected{% endif %}>Studio</option>
                    </select>
                </div>
                <!-- Search Button -->
                <div class="col-span-full md:col-span-2 xl:col-span-1 flex items-end">
                    <button type="submit" class="w-full btn-primary font-bold py-2 px-4 rounded-lg hover:bg-teal-700 transition duration-300 flex items-center justify-center space-x-2">
                        <span><i class="fas fa-search"></i></span>
                        <span>Search</span>
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- Property Listings Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- The view passes the paginated object as 'properties' -->
        {% for listing in properties.object_list %}
        <div class="bg-white rounded-3xl shadow-xl overflow-hidden property-card card-fade-in" style="animation-delay: {{ forloop.counter }}s;">
            <!-- Assuming you have an image URL field or a placeholder -->
            {% if listing.image %}
                <img class="h-56 w-full object-cover" src="{{ listing.image.url }}" alt="{{ listing.name }}">
            {% else %}
                <img class="h-56 w-full object-cover" src="https://placehold.co/600x400/E5E7EB/4B5563?text=Property" alt="{{ listing.name }}">
            {% endif %}
            <div class="p-6">
                <!-- Displaying the property type dynamically -->
                <div class="uppercase tracking-wide text-xs text-teal-600 font-semibold">{{ listing.property_type }}</div>
                <!-- The link has been changed to a placeholder since a guest-specific detail URL is not defined yet -->
                <a href="#" class="block mt-1 text-lg leading-tight font-bold text-gray-900 hover:text-teal-600 transition-colors duration-200">{{ listing.name }}</a>
                <p class="mt-2 text-sm text-gray-500 flex items-center"><i class="fas fa-map-marker-alt text-gray-400 mr-2"></i> {{ listing.city }}</p>
                <div class="mt-4 flex items-center text-xs text-gray-600 border-t pt-4">
                    <!-- Displaying the new fields from the model -->
                    <span class="flex items-center mr-4"><i class="fas fa-bed mr-2"></i> {{ listing.beds }} Beds</span>
                    <span class="flex items-center mr-4"><i class="fas fa-bath mr-2"></i> {{ listing.baths }} Baths</span>
                    <span class="flex items-center"><i class="fas fa-ruler-combined mr-2"></i> {{ listing.sqft }} sqft</span>
                </div>
                 <div class="mt-4 flex justify-between items-center border-t pt-4">
                    <p class="text-2xl font-bold text-gray-900">
                        <span class="text-base align-top font-bold">Ksh</span>{{ listing.price }}
                        <span class="text-sm font-normal text-gray-500">/night</span>
                    </p>
                    <a href="{% url 'properties:property_detail' listing.id %}" class="px-4 py-2 bg-gray-800 text-white text-sm font-semibold rounded-lg hover:bg-gray-900 transition duration-300 flex items-center space-x-2">
                        <i class="fas fa-info-circle"></i>
                        <span>Details</span>
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-span-1 md:col-span-2 lg:col-span-3 text-center py-20">
            <i class="fas fa-search-dollar text-8xl text-gray-400 mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">No properties found</h2>
            <p class="text-lg text-gray-600">Try adjusting your search filters to find a perfect match.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="mt-16 flex justify-center items-center space-x-1">
        {% if properties.has_previous %}
            <a href="?page=1&location={{ location|default:'' }}&property-type={{ property_type|default:'' }}&guests={{ guests|default:'' }}" class="pagination-link px-4 py-2 text-gray-700 bg-white rounded-lg hover:bg-teal-600 hover:text-white transition-colors duration-200">
                &laquo; First
            </a>
            <a href="?page={{ properties.previous_page_number }}&location={{ location|default:'' }}&property-type={{ property_type|default:'' }}&guests={{ guests|default:'' }}" class="pagination-link px-4 py-2 text-gray-700 bg-white rounded-lg hover:bg-teal-600 hover:text-white transition-colors duration-200">
                Previous
            </a>
        {% endif %}
        
        <span class="px-4 py-2 font-bold bg-teal-600 text-white rounded-lg">{{ properties.number }}</span>

        {% if properties.has_next %}
            <a href="?page={{ properties.next_page_number }}&location={{ location|default:'' }}&property-type={{ property_type|default:'' }}&guests={{ guests|default:'' }}" class="pagination-link px-4 py-2 text-gray-700 bg-white rounded-lg hover:bg-teal-600 hover:text-white transition-colors duration-200">
                Next
            </a>
            <a href="?page={{ properties.paginator.num_pages }}&location={{ location|default:'' }}&property-type={{ property_type|default:'' }}&guests={{ guests|default:'' }}" class="pagination-link px-4 py-2 text-gray-700 bg-white rounded-lg hover:bg-teal-600 hover:text-white transition-colors duration-200">
                Last &raquo;
            </a>
        {% endif %}
    </div>
</div>
<!-- Properties Page Content End -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const hasFilters = urlParams.has('location') || urlParams.has('property-type') || urlParams.has('guests');
        const notification = document.getElementById('notification-message');
        
        if (hasFilters) {
            notification.textContent = 'Search results updated successfully!';
            notification.classList.remove('hidden');
            notification.classList.add('fade-out');
        }
    });
</script>
{% endblock %}
